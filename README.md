## Organization of the project

ARM/     arm source example and compilation with libmincaml   
asml/    asml examples
doc/     all the documentation, start with index.hml
mincaml/ MinCaml examples
ocaml/   MinCaml parser in OCaml, if you do the project in OCaml
scripts/ put your test scripts and symbolic links there, and add this 
         directory to your path
tests/   put your tests there
tools/   asml intepreter (linux binary)

We recommend that you add scripts/ and the dir that contains mincamlc to your
PATH.


## Usage:

  `./mincamlc  filenames`

  -o                     Outputs to file <file>
  -h                     Display help
  -v                     Display compiler's version
  -t                     Only do typechecking
  -asml                  Print asml
  -from-asml             Compile from ASML input file
  -inline-threshold      Configure inline expansion threshold
  -int-as-default-type   Use Int as fallback type
  -help                  Display this list of options
  --help                 Display this list of options

## Testing

The whole compiler can be tested using `make test` which is going to run
all of our smaller test suites.

To run specific test suites, run:

`make test_typechecking`

`make test_asml_gen`

`make test_asm_gen`

`make test_asm_output`

## Specifications of the project

The project currently supports arithmetic expressions, function definitions 
assuming it is a pure function depending on its own arguments (but not
closures), calls to functions and if-then-else statements.
It also supports parsing ASML directly and thus generating assembly from it.

### Register Allocation

The compiler now always spills variables and parameters to the stack, except
for predefined functions, in which it uses registers r0-r3.
After ASML generation, each variable is assigned a negative offset from the
frame pointer.
Parameters to functions are assigned a positive offset.

### Typing

The compiler currently first generates all typing equations and resolves them
afterwards with the unification function. An occurs check is used to detect
cyclic types.

Differences from the paper: If after the type inference there are still some
unresolved type variables the current functions fail. The paper suggests to
arbitrarily replace those type variables by Int. The current approach makes it
easier to detect fault in our type inference implementation.

Furthermore we do not yet implement the external variable environment i.e. we
fail when we encounter unbound variables.

### Frontend
The compiler has the following optimisations: beta reduction, inline expansion, constant folding and elimination of unnecessary definitions. The size of function to be expanded in inline expanded is user configurable.


### Error Messages
#### Probably User Error
- "Error during parsing of minCaml: parse error near characters N-M"
- "Error during lexing of minCaml: unknown token %s near characters N-M"
  - These two errors indicate that the input minCaml file is malformed.
- "warning (minCaml): unterminated comment@."
- "warning (ASML): unterminated comment@."
  - There is a runaway comments in an input file
- "Recursive type detected. Aborting"
  - This error occurs when the type checker detects a recursive type which would lead to an infinite loop
- "Functions have different numbers of arguments."
  - There are incoherent assumptions about a function's number of arguments.
- "Tuple lengths do not match."
  - There are incoherent assumptions about a tuple's number of elements
- "Expected function, received T"
  - A function application has been attempted but the "function" is actually a value of type T.
- "Type variable is still undefined"
  - The unification process did not have enough information to conclude a unique type for every variable.
- "Error during lexing of ASML: unknown token X near characters N-M"
- "Error during parsing of AMSL: parse error near characters N-M"
  - The input ASML file (mincamlc -asml FILE) is malformed. If the input ASML file was generated by mincamlc please report the issue to the developers.
- "Cannot use -o with more than one input file."
- "Cannot typecheck an ASML file."
  - Self-explanatory

#### Probably Compiler Error
- "Cannot convert invalid Id.label to Id.t"
  - An attempt was made to transfor an Id.l into an Id.t while the former was not actually a label.
- "LetTuple definition body did not evaluate to a variable"
  - A LetTuple's defintion body must evaluate to a variable pointing to the allocated memory for that tuple.
- "Closure.Float to ASML is handled in closure_to_t instead"
  - Floating point numbers cause the creation of labels and variables. This cannot be handled in `closure_to_exp`.
- "Variable FUN.X does not exist in association list."
  - A variable name that has not been bound is used. This error message indicates that a let binding was erroneously supressed, probably in elim.ml.
- "Free variable X was not found while processing let rec of F"
  - While trying to create a closure it was discovered that the variable X being closed over is not currently bound.
- "Unification of T1 and T2 is impossible.\n"
  - Generic typing error. Better diagnostics are currently unavailable.
- "Closure.Let F = ... cannot be translated to Asml.exp"
- "Conversion from Closure's %s to Asml.exp is not implemented."
  - These cases cannot be handled in closure_to_exp, they need to be caught in closure_to_t

### Remark

User-defined functions should not start with `_min_caml_`.
